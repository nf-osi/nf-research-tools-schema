arrange(total_score) %>%
select(resourceName, resourceType, total_score, completeness_category)
print(head(incomplete_tools, 20))
# Save results to CSV
write.csv(all_scores, "tool_completeness_scores.csv", row.names = FALSE)
write.csv(summary_by_type, "tool_completeness_summary.csv", row.names = FALSE)
cat("\n✓ Results saved to:\n")
cat("  - tool_completeness_scores.csv\n")
cat("  - tool_completeness_summary.csv\n")
# Store results as a Synapse table
cat("\nStoring results as Synapse table...\n")
# Define table schema
table_schema <- Schema(
name = "ToolCompletenessScores",
parent = "syn26338068",
columns = list(
Column(name = "resourceId", columnType = "STRING", maximumSize = 50),
Column(name = "resourceName", columnType = "STRING", maximumSize = 255),
Column(name = "resourceType", columnType = "STRING", maximumSize = 50),
Column(name = "rrid", columnType = "STRING", maximumSize = 100),
Column(name = "total_score", columnType = "DOUBLE"),
Column(name = "biobank_url_score", columnType = "DOUBLE"),
Column(name = "vendor_developer_score", columnType = "DOUBLE"),
Column(name = "rrid_score", columnType = "DOUBLE"),
Column(name = "doi_score", columnType = "DOUBLE"),
Column(name = "critical_info_score", columnType = "DOUBLE"),
Column(name = "other_info_score", columnType = "DOUBLE"),
Column(name = "observation_score", columnType = "DOUBLE"),
Column(name = "missing_availability", columnType = "STRING", maximumSize = 500),
Column(name = "missing_critical_info", columnType = "STRING", maximumSize = 500),
Column(name = "missing_other_info", columnType = "STRING", maximumSize = 500),
Column(name = "observation_status", columnType = "STRING", maximumSize = 200),
Column(name = "completeness_category", columnType = "STRING", maximumSize = 50)
)
)
# Create and store the table
table_object <- Table(table_schema, all_scores)
table_result <- synStore(table_object)
cat("\n✓ Completeness scores stored as Synapse table:", table_result$tableId, "\n")
cat("  View at: https://www.synapse.org/Synapse:", table_result$tableId, "\n")
# Also store summary statistics as a separate table
cat("\nStoring summary statistics as Synapse table...\n")
summary_schema <- Schema(
name = "ToolCompletenessSummary",
parent = "syn26338068",
columns = list(
Column(name = "resourceType", columnType = "STRING", maximumSize = 50),
Column(name = "count", columnType = "INTEGER"),
Column(name = "mean_score", columnType = "DOUBLE"),
Column(name = "median_score", columnType = "DOUBLE"),
Column(name = "min_score", columnType = "DOUBLE"),
Column(name = "max_score", columnType = "DOUBLE"),
Column(name = "sd_score", columnType = "DOUBLE"),
Column(name = "excellent", columnType = "INTEGER"),
Column(name = "good", columnType = "INTEGER"),
Column(name = "fair", columnType = "INTEGER"),
Column(name = "poor", columnType = "INTEGER"),
Column(name = "minimal", columnType = "INTEGER")
)
)
# Create and store the summary table
summary_table_object <- Table(summary_schema, summary_by_type)
summary_table_result <- synStore(summary_table_object)
cat("✓ Summary statistics stored as Synapse table:", summary_table_result$tableId, "\n")
cat("  View at: https://www.synapse.org/Synapse:", summary_table_result$tableId, "\n")
library(synapser)
library(dplyr)
library(tidyr)
# Login to Synapse (you'll need to authenticate first)
synLogin()
# Function to count non-NA, non-empty values
count_filled <- function(x) {
sum(!is.na(x) & x != "" & x != "NULL", na.rm = TRUE)
}
# Function to calculate completeness score for a tool
calculate_tool_score <- function(resource_data, observations_data, pub_data) {
score_breakdown <- list()
missing_fields <- list()
total_score <- 0
tool_type <- resource_data$resourceType
# Availability (30 points)
availability_score <- 0
availability_missing <- c()
if (!is.na(tool_type) && tool_type == "Biobank") {
# For biobanks: biobankURL (30 points)
if (!is.null(resource_data$biobankURL) && !is.na(resource_data$biobankURL) &&
resource_data$biobankURL != "" && resource_data$biobankURL != "NULL") {
availability_score <- 30
} else {
availability_missing <- c(availability_missing, "biobankURL")
}
score_breakdown$biobank_url <- availability_score
} else {
# For other resource types: vendor/developer (15), RRID (7.5), DOI (7.5)
# Vendor/developer: 15 points
vendor_developer_score <- 0
# Check if acquisition contact is available
has_acquisition_info <- (!is.null(resource_data$howToAcquire) &&
!is.na(resource_data$howToAcquire) &&
resource_data$howToAcquire !=
paste0("We don't know of a reliable source for this tool.",
"If you do, let us know at nf-osi@sagebionetworks.org!"))
if (has_acquisition_info) {
vendor_developer_score <- 15
} else {
availability_missing <- c(availability_missing, "howToAcquire")
}
score_breakdown$vendor_developer <- vendor_developer_score
availability_score <- availability_score + vendor_developer_score
# RRID: 7.5 points
rrid_score <- 0
if (!is.null(resource_data$rrid) && !is.na(resource_data$rrid) &&
resource_data$rrid != "" && resource_data$rrid != "NULL") {
rrid_score <- 7.5
} else {
availability_missing <- c(availability_missing, "rrid")
}
score_breakdown$rrid <- rrid_score
availability_score <- availability_score + rrid_score
# DOI: 7.5 points
doi_score <- 0
if (nrow(pub_data)>0 && !is.null(pub_data$publicationId) && !is.na(pub_data$publicationId) &&
pub_data$publicationId != "" && pub_data$publicationId != "NULL") {
doi_score <- 7.5
} else {
availability_missing <- c(availability_missing, "publicationId")
}
score_breakdown$doi <- doi_score
availability_score <- availability_score + doi_score
}
missing_fields$availability <- paste(availability_missing, collapse="; ")
total_score <- total_score + availability_score
# Critical info (30 points distributed evenly)
critical_info_score <- 0
critical_info_missing <- c()
if (!is.na(tool_type)) {
if (tool_type == "Animal Model") {
# 4 fields with high completion: animalModelGeneticDisorder, backgroundStrain, animalState, description
fields <- c("animalModelGeneticDisorder", "backgroundStrain", "animalState", "description")
} else if (tool_type == "Cell Line") {
# 4 fields with high completion: cellLineCategory, cellLineGeneticDisorder, cellLineManifestation, synonyms
fields <- c("cellLineCategory", "cellLineGeneticDisorder", "cellLineManifestation", "synonyms")
} else if (tool_type == "Antibody") {
# 5 fields with high completion: targetAntigen, reactiveSpecies, hostOrganism, clonality, conjugate
fields <- c("targetAntigen", "reactiveSpecies", "hostOrganism", "clonality", "conjugate")
} else if (tool_type == "Genetic Reagent") {
# 5 fields with high completion: insertName, insertSpecies, vectorType, insertEntrezId, vectorBackbone
fields <- c("insertName", "insertSpecies", "vectorType", "insertEntrezId", "vectorBackbone")
} else if (tool_type == "Biobank") {
# 5 fields with high completion: specimenTissueType, diseaseType, tumorType, specimenFormat, specimenType
fields <- c("specimenTissueType", "diseaseType", "tumorType", "specimenFormat", "specimenType")
} else {
fields <- c()
}
# Count how many critical info fields are filled (evenly distributed to 30 points)
if (length(fields) > 0) {
for (field in fields) {
is_filled <- !is.null(resource_data[[field]]) && !is.na(resource_data[[field]]) &&
resource_data[[field]] != "" && resource_data[[field]] != "NULL"
if (!is_filled) {
critical_info_missing <- c(critical_info_missing, field)
}
}
filled_count <- length(fields) - length(critical_info_missing)
critical_info_score <- (filled_count / length(fields)) * 30
}
}
missing_fields$critical_info <- paste(critical_info_missing, collapse="; ")
score_breakdown$critical_info <- round(critical_info_score, 1)
total_score <- total_score + critical_info_score
# Other info (15 points distributed evenly)
other_info_score <- 0
other_info_missing <- c()
if (!is.na(tool_type)) {
if (tool_type == "Animal Model") {
# 3 fields with medium completion: backgroundSubstrain, synonyms, animalModelOfManifestation
fields <- c("backgroundSubstrain", "synonyms", "animalModelOfManifestation")
} else if (tool_type == "Cell Line") {
# 1 field with medium completion: tissue
fields <- c("tissue")
} else if (tool_type == "Antibody") {
# 1 field with medium completion: cloneId
fields <- c("cloneId")
} else if (tool_type == "Genetic Reagent") {
# 2 fields with medium completion: synonyms, promoter
fields <- c("synonyms", "promoter")
} else if (tool_type == "Biobank") {
# 1 field with medium completion: specimenPreparationMethod
fields <- c("specimenPreparationMethod")
} else {
fields <- c()
}
# Count how many other info fields are filled (evenly distributed to 15 points)
if (length(fields) > 0) {
for (field in fields) {
is_filled <- !is.null(resource_data[[field]]) && !is.na(resource_data[[field]]) &&
resource_data[[field]] != "" && resource_data[[field]] != "NULL"
if (!is_filled) {
other_info_missing <- c(other_info_missing, field)
}
}
filled_count <- length(fields) - length(other_info_missing)
other_info_score <- (filled_count / length(fields)) * 15
}
}
missing_fields$other_info <- paste(other_info_missing, collapse="; ")
score_breakdown$other_info <- round(other_info_score, 1)
total_score <- total_score + other_info_score
# Observations (25 points max)
# With DOI: 7.5 points each, No DOI: 2.5 points each
observation_score <- 0
observation_status <- ""
obs_with_doi <- 0
obs_without_doi <- 0
if (!is.null(observations_data) && nrow(observations_data) > 0) {
for (i in 1:nrow(observations_data)) {
obs <- observations_data[i, ]
# Check if observation has a DOI
has_doi <- !is.null(obs$doi) && !is.na(obs$doi) && obs$doi != "" && obs$doi != "NULL"
if (has_doi) {
observation_score <- observation_score + 7.5
obs_with_doi <- obs_with_doi + 1
} else {
observation_score <- observation_score + 2.5
obs_without_doi <- obs_without_doi + 1
}
# Cap at 25 points
if (observation_score >= 25) {
observation_score <- 25
break
}
}
observation_status <- sprintf("%d with DOI, %d without DOI", obs_with_doi, obs_without_doi)
} else {
observation_status <- "No observations"
}
missing_fields$observations <- observation_status
score_breakdown$observations <- observation_score
total_score <- total_score + observation_score
return(list(
total_score = round(total_score, 1),
breakdown = score_breakdown,
missing_fields = missing_fields
))
}
# Main scoring function
score_all_tools <- function() {
# Read base Resource table
cat("Reading base Resource data from Synapse...\n")
resource_query <- synTableQuery(
"SELECT * FROM syn26450069"
)
resource_df <- as.data.frame(resource_query)
# Read type-specific tables
cat("Reading Animal Model data...\n")
animal_model_query <- synTableQuery("SELECT * FROM syn26486808")
animal_model_df <- as.data.frame(animal_model_query)
cat("Reading Antibody data...\n")
antibody_query <- synTableQuery("SELECT * FROM syn26486811")
antibody_df <- as.data.frame(antibody_query)
cat("Reading Biobank data...\n")
biobank_query <- synTableQuery("SELECT * FROM syn26486821")
biobank_df <- as.data.frame(biobank_query)
cat("Reading Cell Line data...\n")
cell_line_query <- synTableQuery("SELECT * FROM syn26486823")
cell_line_df <- as.data.frame(cell_line_query)
cat("Reading Genetic Reagent data...\n")
genetic_reagent_query <- synTableQuery("SELECT * FROM syn26486832")
genetic_reagent_df <- as.data.frame(genetic_reagent_query)
# Join base resource data with type-specific data
cat("Joining resource data with type-specific tables...\n")
# Create full dataset by joining based on resourceType
resource_df <- resource_df %>%
left_join(
animal_model_df %>% filter(!is.na(animalModelId)),
by = "animalModelId",
suffix = c("", ".animal")
) %>%
left_join(
antibody_df %>% filter(!is.na(antibodyId)),
by = "antibodyId",
suffix = c("", ".antibody")
) %>%
left_join(
biobank_df %>% filter(!is.na(biobankId)),
by = "biobankId",
suffix = c("", ".biobank")
) %>%
left_join(
cell_line_df %>% filter(!is.na(cellLineId)),
by = "cellLineId",
suffix = c("", ".cellline")
) %>%
left_join(
genetic_reagent_df %>% filter(!is.na(geneticReagentId)),
by = "geneticReagentId",
suffix = c("", ".genetic")
)
# Read observations data
cat("Reading Observation data from Synapse...\n")
obs_query <- synTableQuery(
"SELECT * FROM syn26486836"
)
obs_df <- as.data.frame(obs_query)
# Read publications data
cat("Reading Publication data from Synapse...\n")
pub_query <- synTableQuery(
"SELECT resourceId, publicationId FROM syn26486807"
)
pub_df <- as.data.frame(pub_query)
# Initialize results dataframe
results <- data.frame()
# Calculate scores for each resource
cat("Calculating scores...\n")
for (i in 1:nrow(resource_df)) {
resource <- resource_df[i, ]
# Get observations for this resource
resource_obs <- obs_df %>%
filter(resourceId == resource$resourceId)
# Get observations for this resource
resource_pub <- pub_df %>%
filter(resourceId == resource$resourceId)
# Calculate score
score_result <- calculate_tool_score(resource, resource_obs, resource_pub)
# Create result row
result_row <- data.frame(
resourceId = resource$resourceId,
resourceName = resource$resourceName,
resourceType = resource$resourceType,
rrid = resource$rrid,
total_score = score_result$total_score,
biobank_url_score = ifelse(is.null(score_result$breakdown$biobank_url), NA, score_result$breakdown$biobank_url),
vendor_developer_score = ifelse(is.null(score_result$breakdown$vendor_developer), NA, score_result$breakdown$vendor_developer),
rrid_score = ifelse(is.null(score_result$breakdown$rrid), NA, score_result$breakdown$rrid),
doi_score = ifelse(is.null(score_result$breakdown$doi), NA, score_result$breakdown$doi),
critical_info_score = score_result$breakdown$critical_info,
other_info_score = score_result$breakdown$other_info,
observation_score = score_result$breakdown$observations,
missing_availability = score_result$missing_fields$availability,
missing_critical_info = score_result$missing_fields$critical_info,
missing_other_info = score_result$missing_fields$other_info,
observation_status = score_result$missing_fields$observations,
stringsAsFactors = FALSE
)
results <- rbind(results, result_row)
}
# Add completeness category
results <- results %>%
mutate(
completeness_category = case_when(
total_score >= 80 ~ "Excellent",
total_score >= 60 ~ "Good",
total_score >= 40 ~ "Fair",
total_score >= 20 ~ "Poor",
TRUE ~ "Minimal"
)
)
return(results)
}
# Generate summary statistics by tool type
summarize_scores <- function(scores_df) {
summary_stats <- scores_df %>%
group_by(resourceType) %>%
summarise(
count = n(),
mean_score = mean(total_score, na.rm = TRUE),
median_score = median(total_score, na.rm = TRUE),
min_score = min(total_score, na.rm = TRUE),
max_score = max(total_score, na.rm = TRUE),
sd_score = sd(total_score, na.rm = TRUE),
excellent = sum(completeness_category == "Excellent"),
good = sum(completeness_category == "Good"),
fair = sum(completeness_category == "Fair"),
poor = sum(completeness_category == "Poor"),
minimal = sum(completeness_category == "Minimal")
) %>%
arrange(desc(mean_score))
return(summary_stats)
}
# Run the analysis
cat("Starting tool completeness scoring...\n")
all_scores <- score_all_tools()
# Generate summary
summary_by_type <- summarize_scores(all_scores)
# Display results
cat("\n=== Summary by Tool Type ===\n")
print(summary_by_type)
cat("\n=== Top 10 Most Complete Tools ===\n")
print(all_scores %>%
arrange(desc(total_score)) %>%
select(resourceName, resourceType, rrid, total_score, completeness_category) %>%
head(10))
cat("\n=== Tools Needing Improvement (Score < 40) ===\n")
incomplete_tools <- all_scores %>%
filter(total_score < 40) %>%
arrange(total_score) %>%
select(resourceName, resourceType, total_score, completeness_category)
print(head(incomplete_tools, 20))
# Save results to CSV
write.csv(all_scores, "tool_completeness_scores.csv", row.names = FALSE)
write.csv(summary_by_type, "tool_completeness_summary.csv", row.names = FALSE)
cat("\n✓ Results saved to:\n")
cat("  - tool_completeness_scores.csv\n")
cat("  - tool_completeness_summary.csv\n")
# Helper function to find existing table by name
find_table_by_name <- function(parent_id, table_name) {
tryCatch({
# Query for tables in the parent project
children <- synGetChildren(parent_id)
children_list <- as.list(children)
for (child in children_list) {
if (child$name == table_name && child$type == "org.sagebionetworks.repo.model.table.TableEntity") {
return(child$id)
}
}
return(NULL)
}, error = function(e) {
return(NULL)
})
}
# Store results as a Synapse table
cat("\nStoring results as Synapse table...\n")
# Check if table already exists
existing_table_id <- find_table_by_name("syn26338068", "ToolCompletenessScores")
if (!is.null(existing_table_id)) {
cat("Found existing table:", existing_table_id, "\n")
cat("Updating with new data...\n")
# Get the existing table schema
table_schema <- synGet(existing_table_id)
# Delete all existing rows
current_data <- synTableQuery(paste0("SELECT * FROM ", existing_table_id))
synDelete(current_data)
# Store new data
table_object <- Table(existing_table_id, all_scores)
table_result <- synStore(table_object)
cat("\n✓ Completeness scores updated in Synapse table:", existing_table_id, "\n")
cat("  View at: https://www.synapse.org/#!Synapse:", existing_table_id, "\n")
} else {
cat("Creating new table...\n")
# Define table schema
table_schema <- Schema(
name = "ToolCompletenessScores",
parent = "syn26338068",
columns = list(
Column(name = "resourceId", columnType = "STRING", maximumSize = 50),
Column(name = "resourceName", columnType = "STRING", maximumSize = 255),
Column(name = "resourceType", columnType = "STRING", maximumSize = 50),
Column(name = "rrid", columnType = "STRING", maximumSize = 100),
Column(name = "total_score", columnType = "DOUBLE"),
Column(name = "biobank_url_score", columnType = "DOUBLE"),
Column(name = "vendor_developer_score", columnType = "DOUBLE"),
Column(name = "rrid_score", columnType = "DOUBLE"),
Column(name = "doi_score", columnType = "DOUBLE"),
Column(name = "critical_info_score", columnType = "DOUBLE"),
Column(name = "other_info_score", columnType = "DOUBLE"),
Column(name = "observation_score", columnType = "DOUBLE"),
Column(name = "missing_availability", columnType = "STRING", maximumSize = 500),
Column(name = "missing_critical_info", columnType = "STRING", maximumSize = 500),
Column(name = "missing_other_info", columnType = "STRING", maximumSize = 500),
Column(name = "observation_status", columnType = "STRING", maximumSize = 200),
Column(name = "completeness_category", columnType = "STRING", maximumSize = 50)
)
)
# Create and store the table
table_object <- Table(table_schema, all_scores)
table_result <- synStore(table_object)
cat("\n✓ Completeness scores stored as new Synapse table:", table_result$tableId, "\n")
cat("  View at: https://www.synapse.org/#!Synapse:", table_result$tableId, "\n")
}
# Also store summary statistics as a separate table
cat("\nStoring summary statistics as Synapse table...\n")
# Check if summary table already exists
existing_summary_id <- find_table_by_name("syn26338068", "ToolCompletenessSummary")
if (!is.null(existing_summary_id)) {
cat("Found existing summary table:", existing_summary_id, "\n")
cat("Updating with new data...\n")
# Get the existing table schema
summary_schema <- synGet(existing_summary_id)
# Delete all existing rows
current_summary <- synTableQuery(paste0("SELECT * FROM ", existing_summary_id))
synDelete(current_summary)
# Store new data
summary_table_object <- Table(existing_summary_id, summary_by_type)
summary_table_result <- synStore(summary_table_object)
cat("✓ Summary statistics updated in Synapse table:", existing_summary_id, "\n")
cat("  View at: https://www.synapse.org/#!Synapse:", existing_summary_id, "\n")
} else {
cat("Creating new summary table...\n")
summary_schema <- Schema(
name = "ToolCompletenessSummary",
parent = "syn26338068",
columns = list(
Column(name = "resourceType", columnType = "STRING", maximumSize = 50),
Column(name = "count", columnType = "INTEGER"),
Column(name = "mean_score", columnType = "DOUBLE"),
Column(name = "median_score", columnType = "DOUBLE"),
Column(name = "min_score", columnType = "DOUBLE"),
Column(name = "max_score", columnType = "DOUBLE"),
Column(name = "sd_score", columnType = "DOUBLE"),
Column(name = "excellent", columnType = "INTEGER"),
Column(name = "good", columnType = "INTEGER"),
Column(name = "fair", columnType = "INTEGER"),
Column(name = "poor", columnType = "INTEGER"),
Column(name = "minimal", columnType = "INTEGER")
)
)
# Create and store the summary table
summary_table_object <- Table(summary_schema, summary_by_type)
summary_table_result <- synStore(summary_table_object)
cat("✓ Summary statistics stored as new Synapse table:", summary_table_result$tableId, "\n")
cat("  View at: https://www.synapse.org/#!Synapse:", summary_table_result$tableId, "\n")
}
